<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>留言板</title>

    <meta name="description" content="Mailbox with some customizations as described in docs"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="assets/font-awesome/4.5.0/css/font-awesome.min.css"/>

    <!-- page specific plugin styles -->

    <!-- text fonts -->
    <link rel="stylesheet" href="assets/css/fonts.googleapis.com.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet"/>
    <![endif]-->
    <link rel="stylesheet" href="assets/css/ace-skins.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->
    <script src="assets/js/ace-extra.min.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

    <!--[if lte IE 8]>
    <script src="assets/js/html5shiv.min.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->
</head>

<body class="no-skin">
<div th:replace="commons/bar::#navbar"></div>

<div class="main-container ace-save-state" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.loadState('main-container')
        } catch (e) {
        }
    </script>

    <div id="sidebar" class="sidebar                  responsive                    ace-save-state">
        <script type="text/javascript">
            try {
                ace.settings.loadState('sidebar')
            } catch (e) {
            }
        </script>

        <ul class="nav nav-list">

            <li class="">
                <a th:href="@{/miscellaneous}">
                    <i class="menu-icon fa fa-tachometer"></i>
                    <span class="menu-text"> 寝室杂费管理 </span>
                </a>

                <b class="arrow"></b>
            </li>


            <li class="">
                <a th:href="@{/dorrepair}">
                    <i class="menu-icon fa fa-cogs"></i>
                    <span class="menu-text"> 寝室维修管理 </span>
                </a>

                <b class="arrow"></b>
            </li>


            <li class="">
                <a th:href="@{/studentsignin}">
                    <i class="menu-icon fa fa-pencil-square-o"></i>
                    <span class="menu-text"> 签到管理 </span>
                </a>

                <b class="arrow"></b>
            </li>

            <li class="">
                <a th:href="@{/msgboard}">
                    <i class="menu-icon fa fa-list"></i>
                    <span class="menu-text"> 留言板 </span>
                </a>

                <b class="arrow"></b>
            </li>


        </ul><!-- /.nav-list -->

        <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
            <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state"
               data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
        </div>
    </div>

    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs ace-save-state" id="breadcrumbs">
                <ul class="breadcrumb">
                    <li>
                        <i class="ace-icon fa fa-home home-icon"></i>
                        主页
                    </li>
                    <li class="active">留言板</li>
                </ul><!-- /.breadcrumb -->

            </div>

            <div class="page-content">
                <div class="ace-settings-container" id="ace-settings-container">
                    <div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
                        <i class="ace-icon fa fa-cog bigger-130"></i>
                    </div>

                    <div class="ace-settings-box clearfix" id="ace-settings-box">
                        <div class="pull-left width-50">
                            <div class="ace-settings-item">
                                <div class="pull-left">
                                    <select id="skin-colorpicker" class="hide">
                                        <option data-skin="no-skin" value="#438EB9">#438EB9</option>
                                        <option data-skin="skin-1" value="#222A2D">#222A2D</option>
                                        <option data-skin="skin-2" value="#C6487E">#C6487E</option>
                                        <option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
                                    </select>
                                </div>
                                <span>&nbsp; 风格转换</span>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2 ace-save-state"
                                       id="ace-settings-add-container" autocomplete="off"/>
                                <label class="lbl" for="ace-settings-add-container">
                                    缩小边框
                                </label>
                            </div>
                        </div><!-- /.pull-left -->

                        <div class="pull-left width-50">
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-hover"
                                       autocomplete="off"/>
                                <label class="lbl" for="ace-settings-hover"> 子菜单悬停 </label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-compact"
                                       autocomplete="off"/>
                                <label class="lbl" for="ace-settings-compact"> 紧凑型侧边栏 </label>
                            </div>

                        </div><!-- /.pull-left -->
                    </div><!-- /.ace-settings-box -->
                </div>

                <div class="page-header">
                    <h1>留言板</h1>
                </div><!-- /.page-header -->

                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="tabbable">

                                    <div class="tab-content no-border no-padding">
                                        <div id="inbox" class="tab-pane in active">
                                            <div class="message-container">
                                                <div id="id-message-list-navbar" class="message-navbar clearfix">
                                                    <div class="message-bar">
                                                    </div>
                                                    <div>
                                                        <div class="messagebar-item-left">
                                                            <label class="inline middle">
                                                                <input type="checkbox" id="id-toggle-all" class="ace"/>
                                                                <span class="lbl"></span>
                                                            </label>
                                                        </div>

                                                        <div class="messagebar-item-right">
                                                            <ul id="inbox-tabs"
                                                                class="inbox-tabs nav nav-tabs  tab-size-big tab-space-1">
                                                                <li class="li-new-mail pull-right">
                                                                    <a data-toggle="tab" href="#write"
                                                                       data-target="write" class="btn-new-mail">
																		<span class="btn btn-white btn-primary">
																			<i class="ace-icon fa fa-envelope bigger-130"></i>
																			<span class="bigger-110">发布留言</span>
																		</span>
                                                                    </a>
                                                                </li><!-- /.li-new-mail -->
                                                            </ul>

                                                        </div>
                                                        <div class="nav-search minimized">
                                                            <form class="form-search">
                                                                <span class="input-icon">
                                                                    <input type="text" autocomplete="off"
                                                                           class="input-small nav-search-input"
                                                                           placeholder="Search inbox ..."/>
                                                                    <i class="ace-icon fa fa-search nav-search-icon"></i>
                                                                </span>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div id="id-message-new-navbar" class="hide message-navbar clearfix">
                                                    <div class="message-bar">
                                                    </div>
                                                    <div>
                                                        <div class="messagebar-item-left">
                                                            <a th:href="@{/msgboard}" class="btn-back-message-list">
                                                                <i class="ace-icon fa fa-arrow-left bigger-110 middle blue"></i>
                                                                <b class="middle bigger-110">返回</b>
                                                            </a>
                                                        </div>

                                                        <div class="messagebar-item-right">
                                                            <span class="inline btn-send-message">
                                                                <button type="button"
                                                                        class="btn btn-sm btn-primary no-border btn-white btn-round submit-msg" onclick="save_boardmsg()">
                                                                    <span class="bigger-110">发布</span>

                                                                    <i class="ace-icon fa fa-arrow-right icon-on-right"></i>
                                                                </button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="message-list-container">
                                                    <div class="message-list" id="message-list">

                                                        <div class="message-item message-unread"
                                                              th:each="msg:${pageInfo.list}">
                                                            <label class="inline">
                                                                <input type="checkbox" class="ace"/>
                                                                <span class="lbl"></span>
                                                            </label>

                                                            <i class="message-star ace-icon fa fa-star orange2"
                                                               th:if="${studentDor.get(msg.get('peopleId'))}==null"></i>

                                                            <!-- 头像插入 -->

                                                            <span class="sender"
                                                                  th:text="${studentDor.get(msg.get('peopleId'))}==null?${msg.get('name')}:${studentDor.get(msg.get('peopleId'))}+'      '+${msg.get('name')}">
                                                            </span>
                                                            <a class="red deleteBtn" style="float:right" title="删除" th:if="${msg.get('peopleId')==session.loginuser.getId()}" th:attr="del_uri=@{/msgborad/}+${msg.get('id')}">
                                                                <i class="ace-icon fa fa-trash-o bigger-130"></i>
                                                            </a>
                                                            <span class="sender" style="float:right"
                                                                  th:text="${#dates.format(msg.get('leaveDate'),'yyyy-MM-dd HH:mm')}"></span>
                                                            <span class="summary">
                                                                <span class="text" th:id="${msg.get('id')}" th:text="${msg.get('title')}">
                                                                </span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="message-footer clearfix">
                                                    <div class="pull-left">
                                                        <p>当前 <span th:text="${pageInfo.pageNum}"></span> 页,总 <span
                                                                th:text="${pageInfo.pages}"></span> 页,共 <span
                                                                th:text="${pageInfo.total}"></span> 条记录</p>
                                                    </div>

                                                    <div class="pull-right">
                                                        <ul class="pagination">
                                                            <li th:class="${pageInfo.pageNum}==1?'disabled':''">
                                                                <a th:href="@{/msgboard(pn=${pageInfo.hasPreviousPage}?${pageInfo.prePage}:1)}">
                                                                    <i class="ace-icon fa fa-angle-double-left"></i>
                                                                </a>
                                                            </li>

                                                            <li th:each="num:${pageInfo.getNavigatepageNums()}"
                                                                th:class="${num==pageInfo.pageNum}?'active':''">
                                                                <a th:href="@{/msgboard(pn=${num})}"
                                                                   th:text="${num}"></a>
                                                            </li>

                                                            <li th:class="${pageInfo.pageNum==pageInfo.pages}?'disabled':''">
                                                                <a th:href="@{/msgboard(pn=${pageInfo.hasNextPage}?${pageInfo.nextPage}:${pageInfo.pages})}">
                                                                    <i class="ace-icon fa fa-angle-double-right"></i>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>

                                                <div class="hide message-footer message-footer-style2 clearfix">

                                                </div>


                                            </div>

                                        </div>
                                    </div><!-- /.tab-content -->
                                </div><!-- /.tabbable -->
                            </div><!-- /.col -->
                        </div><!-- /.row -->

                        <form id="id-message-form" class="hide form-horizontal message-form col-xs-12">
                            <div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label no-padding-right">标题:</label>

                                    <div class="col-sm-6 col-xs-12">
                                        <div class="input-icon block col-xs-12 no-padding">
                                            <input maxlength="100" type="text" class="col-xs-12" name="title"
                                                   id="form-field-title" placeholder="标题(最长50个字)" />
                                            <i class="ace-icon fa fa-comment-o"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="hr hr-18 dotted"></div>

                                <div class="form-group">
                                    <label class="col-sm-3 control-label no-padding-right">
                                        <span class="inline space-24 hidden-480"></span>
                                        具体信息:
                                    </label>

                                    <div class="col-sm-9">
                                        <div class="wysiwyg-editor" name="message" id="form-field-message"></div>
                                    </div>
                                </div>

                                <div class="hr hr-18 dotted"></div>

                                <div class="form-group no-margin-bottom">
                                    <label class="col-sm-3 control-label no-padding-right">选择图片:</label>

                                    <div class="col-sm-9">
                                        <input type="file" name="attachment[]" multiple="multiple"/>
                                    </div>
                                </div>

                                <div class="align-right">
                                    <button id="id-add-attachment" type="button" class="btn btn-sm btn-danger">
                                        <i class="ace-icon fa fa-paperclip bigger-140"></i>
                                        添加图片
                                    </button>
                                </div>

                                <div class="space"></div>
                            </div>
                        </form>

                        <div class="hide message-content" th:id="'message-content-'+${msg.get('id')}"
                             th:each="msg:${pageInfo.list}">
                            <div class="message-header clearfix">
                                <div class="pull-left">

                                    <span href="#" class="sender"
                                          th:text="${studentDor.get(msg.get('peopleId'))}==null?${msg.get('name')}:${studentDor.get(msg.get('peopleId'))}+'      '+${msg.get('name')}"></span>

                                    &nbsp;
                                    <i class="ace-icon fa fa-clock-o bigger-110 orange middle"></i>
                                    <span class="time grey"
                                          th:text="${#dates.format(msg.get('leaveDate'),'yyyy-MM-dd HH:mm')}"></span>
                                </div>

                                <div class="pull-right action-buttons">
                                </div>
                            </div>

                            <div class="hr hr-26"></div>

                            <strong>
                            <div class="message-body" th:text="${msg.get('message')}">
                            </div>
                            </strong>

                            <div class="hr hr-26"></div>

                            <div class="message-attachment clearfix">
                                <ul class="attachment-list pull-left list-unstyled">
                                    <li>
                                        <i class="ace-icon fa fa-pencil-square-o bigger-110"></i>
                                        <span class="attached-name">评论</span>
                                        <form onsubmit="save_comment(this)">
                                            <input type="hidden" th:value="${msg.get('id')}" class="msg-id">
                                            <textarea class="form-control limited msg-comment" id="form-field-9" name="comment" maxlength="50" placeholder="最多50个字符" required></textarea>
                                            <button class="btn-xs btn-success" type="submit">
                                                <i class="ace-icon fa fa-check"></i>
                                                发送
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                                <div class="attachment-images pull-right">
                                    <div class="vspace-4-sm"></div>
                                    <div >
                                        <img width="36" name="img"
                                             src="assets/images/gallery/thumb-4.jpg" />
                                        <img width="36" name="img"
                                             src="assets/images/gallery/thumb-4.jpg" />
                                        <img width="36" name="img"
                                             src="assets/images/gallery/thumb-4.jpg" /><!-- 此处是引入图片的路径 -->
                                    </div>
                                </div>
                            </div>

                            <div class="profile-activity clearfix" th:if="${comment.getMsgid()==msg.get('id')}"  th:each="comment:${comments}" >
                                <div>
                                    <h6><li class="text-primary" th:text="${studentDor.get(comment.getPeopleid())}==null?${nameIdMap.get(comment.getPeopleid())}:${studentDor.get(comment.getPeopleid())}+'      '+${nameIdMap.get(comment.getPeopleid())}"></li></h6>
                                    <h6><p th:text="${comment.getComment()}"></p></h6>
                                    <div class="time" th:text="${#dates.format(comment.getLeavedate(),'yyyy-MM-dd HH:mm')}">
                                        <i class="ace-icon fa fa-clock-o bigger-110"></i>
                                    </div>
                                </div>

                                <div class="tools action-buttons">
                                    <a  href="#" class="red" onclick="deleteCom(this)" title="删除该评论" th:attr="del_uri=@{/comment/}+${comment.getId()}">
                                        <i class="ace-icon fa fa-times bigger-125" ></i>
                                    </a>
                                </div>
                            </div>
                            <!-- #dialog-confirm -->
                        </div>
                        <!-- PAGE CONTENT ENDS -->
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.page-content -->
            <form id="deleteComForm" method="post">
                <input type="hidden" name="_method" value="delete">
            </form>

            <form id="deleteBoardMsgForm" method="post">
                <input type="hidden" name="_method" value="delete">
            </form>
        </div>
    </div><!-- /.main-content -->
    <div th:replace="commons/bar::#bottombar"></div>
    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
    </a>
</div><!-- /.main-container -->




<!-- basic scripts -->

<!--[if !IE]> -->
<script src="assets/js/jquery-2.1.4.min.js"></script>

<!-- <![endif]-->

<!--[if IE]>
<script src="assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="assets/js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->
<script src="assets/js/bootstrap-tag.min.js"></script>
<script src="assets/js/jquery.hotkeys.index.min.js"></script>
<script src="assets/js/bootstrap-wysiwyg.min.js"></script>
<script src="assets/js/jquery.colorbox.min.js"></script>

<!-- ace scripts -->
<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>

<!-- inline scripts related to this page -->

<script type="text/javascript">

    function save_comment(obj){
        var comment = $(obj).find(".msg-comment").val();
        var id = $(obj).find(".msg-id").val();
        console.log(comment,id);
        var msg;
        $.ajax({
            url:"/comments",
            data:"comment="+comment+"&msgid="+id,
            type:"POST",
            async:false,
            success:function (result) {
                msg = result.code;
            }
        })

    }

    function deleteCom(obj){
        var r = confirm("是否删除该评论");
        if(r == true) {
            $("#deleteComForm").attr("action", $(obj).attr("del_uri")).submit();
            return false;
        }
    }

    $(".deleteBtn").click(function(){
        var r = confirm("是否删除该留言");
        if(r == true) {
            $("#deleteBoardMsgForm").attr("action", $(this).attr("del_uri")).submit();
            return false;
        }
    });
    function save_boardmsg(){
        var title = $('#form-field-title').val();
        var message = $('#form-field-message').text();
        var msg;
        $.ajax({
            url:"/msgborad",
            data:"title="+title+"&message="+message,
            type:"POST",
            async:false,
            success:function (result) {
                msg = result.code;
            }
        });
        if(msg==100){
            window.location.reload();
        }
    }


    jQuery(function ($) {
        //handling tabs and loading/displaying relevant messages and forms
        //not needed if using the alternative view, as described in docs
        $('#inbox-tabs a[data-toggle="tab"]').on('show.bs.tab', function (e) {
            var currentTab = $(e.target).data('target');
            if (currentTab == 'write') {
                Inbox.show_form();
            } else if (currentTab == 'inbox') {
                Inbox.show_list();
            }
        })


        $("#bootbox-options").on(ace.click_event, function() {
            bootbox.dialog({
                message: "<span class='bigger-110'>I am a custom dialog with smaller buttons</span>",
                buttons:
                    {
                        "success" :
                            {
                                "label" : "<i class='ace-icon fa fa-check'></i> Success!",
                                "className" : "btn-sm btn-success",
                                "callback": function() {
                                    //Example.show("great success");
                                }
                            },
                        "danger" :
                            {
                                "label" : "Danger!",
                                "className" : "btn-sm btn-danger",
                                "callback": function() {
                                    //Example.show("uh oh, look out!");
                                }
                            },
                        "click" :
                            {
                                "label" : "Click ME!",
                                "className" : "btn-sm btn-primary",
                                "callback": function() {
                                    //Example.show("Primary button");
                                }
                            },
                        "button" :
                            {
                                "label" : "Just a button...",
                                "className" : "btn-sm"
                            }
                    }
            });
        });

        //basic initializations
        $('.message-list .message-item input[type=checkbox]').removeAttr('checked');
        $('.message-list').on('click', '.message-item input[type=checkbox]', function () {
            $(this).closest('.message-item').toggleClass('selected');
            if (this.checked) Inbox.display_bar(1);//display action toolbar when a message is selected
            else {
                Inbox.display_bar($('.message-list input[type=checkbox]:checked').length);
                //determine number of selected messages and display/hide action toolbar accordingly
            }
        });


        //check/uncheck all messages
        $('#id-toggle-all').removeAttr('checked').on('click', function () {
            if (this.checked) {
                Inbox.select_all();
            } else Inbox.select_none();
        });

        //select all
        $('#id-select-message-all').on('click', function (e) {
            e.preventDefault();
            Inbox.select_all();
        });

        //select none
        $('#id-select-message-none').on('click', function (e) {
            e.preventDefault();
            Inbox.select_none();
        });

        //select read
        $('#id-select-message-read').on('click', function (e) {
            e.preventDefault();
            Inbox.select_read();
        });

        //select unread
        $('#id-select-message-unread').on('click', function (e) {
            e.preventDefault();
            Inbox.select_unread();
        });

        /////////


        //display second message right inside the message list
        $('.message-list .message-item .text').on('click', function () {
            var message = $(this).closest('.message-item');
            var id = $(this).attr('id');
            //if message is open, then close it
            if (message.hasClass('message-inline-open')) {
                message.removeClass('message-inline-open').find('.message-content').remove();
                return;
            }

            $('.message-container').append('<div class="message-loading-overlay"><i class="fa-spin ace-icon fa fa-spinner orange2 bigger-160"></i></div>');
            setTimeout(function () {
                $('.message-container').find('.message-loading-overlay').remove();
                message
                    .addClass('message-inline-open')
                    .append('<div class="message-content" />')
                var content = message.find('.message-content:last').html($('#message-content-' + id).html());

                //remove scrollbar elements
                content.find('.scroll-track').remove();
                content.find('.scroll-content').children().unwrap();

                content.find('.message-body').ace_scroll({
                    size: 150,
                    mouseWheelLock: true,
                    styleClass: 'scroll-visible'
                });

            }, 500 + parseInt(Math.random() * 500));

        });



        //hide message list and display new message form
        /**
         $('.btn-new-mail').on('click', function(e){
					e.preventDefault();
					Inbox.show_form();
				});
         */




        var Inbox = {
            //displays a toolbar according to the number of selected messages
            display_bar: function (count) {
                if (count == 0) {
                    $('#id-toggle-all').removeAttr('checked');
                    $('#id-message-list-navbar .message-toolbar').addClass('hide');
                    $('#id-message-list-navbar .message-infobar').removeClass('hide');
                } else {
                    $('#id-message-list-navbar .message-infobar').addClass('hide');
                    $('#id-message-list-navbar .message-toolbar').removeClass('hide');
                }
            }
            ,
            select_all: function () {
                var count = 0;
                $('.message-item input[type=checkbox]').each(function () {
                    this.checked = true;
                    $(this).closest('.message-item').addClass('selected');
                    count++;
                });

                $('#id-toggle-all').get(0).checked = true;

                Inbox.display_bar(count);
            }
            ,
            select_none: function () {
                $('.message-item input[type=checkbox]').removeAttr('checked').closest('.message-item').removeClass('selected');
                $('#id-toggle-all').get(0).checked = false;

                Inbox.display_bar(0);
            }
            ,
            select_read: function () {
                $('.message-unread input[type=checkbox]').removeAttr('checked').closest('.message-item').removeClass('selected');

                var count = 0;
                $('.message-item:not(.message-unread) input[type=checkbox]').each(function () {
                    this.checked = true;
                    $(this).closest('.message-item').addClass('selected');
                    count++;
                });
                Inbox.display_bar(count);
            }
            ,
            select_unread: function () {
                $('.message-item:not(.message-unread) input[type=checkbox]').removeAttr('checked').closest('.message-item').removeClass('selected');

                var count = 0;
                $('.message-unread input[type=checkbox]').each(function () {
                    this.checked = true;
                    $(this).closest('.message-item').addClass('selected');
                    count++;
                });

                Inbox.display_bar(count);
            }
        }

        //show message list (back from writing mail or reading a message)
        Inbox.show_list = function () {
            $('.message-navbar').addClass('hide');
            $('#id-message-list-navbar').removeClass('hide');

            $('.message-footer').addClass('hide');
            $('.message-footer:not(.message-footer-style2)').removeClass('hide');

            $('.message-list').removeClass('hide').next().addClass('hide');
            //hide the message item / new message window and go back to list
        }

        //show write mail form
        Inbox.show_form = function () {
            if ($('.message-form').is(':visible')) return;
            if (!form_initialized) {
                initialize_form();
            }


            var message = $('.message-list');
            $('.message-container').append('<div class="message-loading-overlay"><i class="fa-spin ace-icon fa fa-spinner orange2 bigger-160"></i></div>');

            setTimeout(function () {
                message.next().addClass('hide');

                $('.message-container').find('.message-loading-overlay').remove();

                $('.message-list').addClass('hide');
                $('.message-footer').addClass('hide');
                $('.message-form').removeClass('hide').insertAfter('.message-list');

                $('.message-navbar').addClass('hide');
                $('#id-message-new-navbar').removeClass('hide');


                //reset form??
                $('.message-form .wysiwyg-editor').empty();

                $('.message-form .ace-file-input').closest('.file-input-container:not(:first-child)').remove();
                $('.message-form input[type=file]').ace_file_input('reset_input');

                $('.message-form').get(0).reset();

            }, 300 + parseInt(Math.random() * 300));
        }


        var form_initialized = false;

        function initialize_form() {
            if (form_initialized) return;
            form_initialized = true;

            //intialize wysiwyg editor
            $('.message-form .wysiwyg-editor').ace_wysiwyg({
                toolbar:
                    [
                        'bold',
                        'italic',
                        'strikethrough',
                        'underline',
                        null,
                        'justifyleft',
                        'justifycenter',
                        'justifyright',
                        null,
                        'createLink',
                        'unlink',
                        null,
                        'undo',
                        'redo'
                    ]
            }).prev().addClass('wysiwyg-style1');


            //file input
            $('.message-form input[type=file]').ace_file_input()
                .closest('.ace-file-input')
                .addClass('width-90 inline')
                .wrap('<div class="form-group file-input-container"><div class="col-sm-7"></div></div>');

        }//initialize_form

        //turn the recipient field into a tag input field!
        /**
         var tag_input = $('#form-field-recipient');
         try {
					tag_input.tag({placeholder:tag_input.attr('placeholder')});
				} catch(e) {}


         //and add form reset functionality
         $('#id-message-form').on('reset', function(){
					$('.message-form .message-body').empty();
					
					$('.message-form .ace-file-input:not(:first-child)').remove();
					$('.message-form input[type=file]').ace_file_input('reset_input_ui');
			
					var val = tag_input.data('value');
					tag_input.parent().find('.tag').remove();
					$(val.split(',')).each(function(k,v){
						tag_input.before('<span class="tag">'+v+'<button class="close" type="button">&times;</button></span>');
					});
				});
         */

    });

</script>
</body>
</html>
